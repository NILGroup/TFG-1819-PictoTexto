% !TeX encoding = ISO-8859-1

\chapter{Arquitectura}
\label{cap:Arquitectura}

En el siguiente capitulo hablaremos de la arquitectura que hemos dise�ado para la aplicaci�n los distintos m�dulos de la misma y como se integran entre si. La aplicaci�n esta formada por diferentes partes o m�dulos que se integran para conseguir la traducci�n de pictogramas a lenguaje natural, adem�s para facilitar su uso se ha a�adido un buscador de pictogramas y un traductor de pictogramas por id, tal y como podemos ver en la Figura \ref{fig:appEscritorio}, adem�s hemos querido desarrollar la aplicaci�n para que sea responsive y se pueda utilizar en cualquier dispositivo tal y como podemos ver en la Figura \ref{fig:appMo}.
\figura{Bitmap/Arquitectura/appEscritorio}{width=300px}{fig:appEscritorio}{Pict2Text versi�n escritorio}
\figura{Bitmap/Arquitectura/appMo}{width=200px}{fig:appMo}{Pict2Text versi�n m�vil}
%------------------------------------------------------------------
\section{Arquitectura}
%-------------------------------------------------------------------
\label{cap5:sec:Arquitectura}

El trabajo de este TFG est� englobado dentro del proyecto nacional IDiLyCo\footnote{http://nil.fdi.ucm.es/index.php?q=projects/idilyco}. IDiLyCo es un proyecto que busca facilitar la inclusi�n digital, de aquellas personas que por diversidad   funcional, tienen problemas con el lenguaje natural. Uno de los objetivos del proyecto es desarrollar peque�as piezas de funcionalidad reutilizables que se combinan en diferentes aplicaciones, es por ello que  deb�amos dise�ar una arquitectura con muy bajo acoplamiento. Por esa raz�n hemos decidido utilizar una arquitectura orientada a servicios en la parte back-end, y a componentes en la parte front-end. En ambas casos, hemos seguido los principios\citep{martin2013agile}: 

\begin{itemize}

\item Principio de Responsabilidad �nica. Este principio promueve la separaci�n de las clases para que cada clase haga una sola cosa, y no dependa de un tercero. Cada clase debe de ser responsable �nicamente de su comportamiento y no tener dependencia de un tercero. Un ejemplo de violaci�n de este principio es cuando en una misma clase, est�n involucradas dos capas diferentes de la arquitectura. Adem�s este principio promueve la creaci�n de m�ltiples clases muy simples, con l�gica m�nima, en contra de una clase con una l�gica mayor, ya que est� ultima produce un fuerte acoplamiento y disminuye la sostenibilidad del c�digo. Por ejemplo en nuestro proyecto todos los Servicios Web, son independientes unos de  otros.

\item Principio de Segregaci�n de la Interfaz. Este principio busca abstraer lo m�ximo posible las interfaces de todas las clases, para as� poder re-aprovecharlas en otras clases. Un ejemplo es la interfaz de peticiones de la aplicaci�n angular donde todos los componentes de la aplicaci�n hacen uso de la misma clase para lanzar las peticiones a los servicios web.

\item Principio de Inversi�n de Dependencias. Consiste en evitar dependencias externas dentro del c�digo, y que el c�digo central de las aplicaciones no dependa de frameworks, de bases de datos o del como se conecten los diferentes servicios entre ellos. Normalmente se habla de que las clases de alto nivel no deben de depender de las clases de bajo nivel\footnote{https://devexperto.com/principio-de-inversi�n-de-dependencias/}, un ejemplo de esto en nuestra aplicaci�n es el uso de Servicios Web, que reciben tipos b�sicos y devuelven los resultados en formato JSON.

\end{itemize}

Estos principios tienen como finalidad crear un producto software de calidad que sea robusto, producir c�digo ordenado y limpio dando adem�s una gran flexibilidad buscando que sea reutilizable y f�cilmente mantenible gracias al bajo acoplamiento que se consigue y por ultimo permitir la escalabilidad, gracias a una alta modular obtenida por la separaci�n de responsabilidades.



%------------------------------------------------------------------
\section{Componentes y Servicios Angular}
%-------------------------------------------------------------------
\label{cap5:sec:ComponentesAngular}

En esta secci�n introduciremos los diferentes servicios y componentes Angular desarrollados para la parte Front-End de la aplicaci�n. Hemos implementado diferentes componentes: un buscador de pictogramas, un traductor de pictograma por id, y el componente traductor de pictogramas, que sirve de contenedor para los diferentes pictogramas que vamos a traducir. Cabe destacar que cada uno de estos componentes posee un HTML, controlador y servicio de aplicaci�n propio.  A parte de estos componentes hemos implementado una serie de �tiles, como un archivo de constantes, para almacenar las diferentes direcciones de los servicios web, un servicio proxy que permite abstraer las peticiones HTTP, y por ultimo otro servicio de modales para el tratamiento de errores.


\subsection{Servicio Proxy}

El servicio proxy de la aplicaci�n Angular sirve para abstraer las diferentes llamadas HTTP del resto de la aplicaci�n, este componente es necesario ya que sirve de punto de acceso a los Servicios Web explicados en el Capitulo \ref{cap5:serviciosWeb}. Sus m�todos se encargan de enviar las peticiones HTTP que se necesitan (GET o POST), esperar la respuesta del servicio y devolverla al servicio de aplicaci�n.
Cuando una clase llama cualquier m�todo del Servicio Proxy, se convierte en un subscriptor del Servicio Proxy, gracias a esta suscripci�n cuando se recibe la respuesta de la llamada HTTP, el Servicio Proxy encargar de avisar a los suscriptores de que tiene la respuesta y d�rsela. Esto es gracias al patron Observer que implementa Angular en las llamadas HTTP. En caso de que la respuesta de la llamada fuera un error, el Servicio Proxy, volver� reintentara la llamada hasta cinco veces, cuando la quinta falla devuelve el error a sus subscriptores. En la Figura \ref{fig:proxyClassDiagram} podemos ver un diagrama de clases del Servicio Proxy.

\figura{Bitmap/Arquitectura/proxyService}{width=200px}{fig:proxyClassDiagram}{Diagrama de clase del Servicio Proxy}

\subsection{Servicio de modales}  

El servicio de modales, es un componente reutilizable que se inyecta en los componentes. Su utilidad principal es construir y mostrar una modal  gen�rica, dado un error especifico, con el fin de mostrar dar al usuario feedback de los errores que puedan darse. Sigue el patr�n Factory, es decir su finalidad es crear objetos concretos gracias a sus datos de entrada, tal y como podemos ver en la Figura \ref{fig:errorModalExample}. Adem�s de esto hemos utilizado la librer�a NGBoostrap\footnote{https://ng-bootstrap.github.io/} para la implementaci�n de este servicio de modales, esta librer�a hace uso del patron Singleton para las modales, y ademas abstrae todos la funcionalidad relacionada con el uso de modales, como pueda ser la l�gica de abrir o cerrar la modal. Adem�s de la funcionalidad tiene estilos CSS propios, que ayudan a definir el tama�o de la modal, el fondo que se pone sobre el body de la pagina etc. 
Este servicio tiene dos variables de entrada el c�digo de error y el texto asociado al error, ambos obtenidos del error devuelto por el servicio. En la Figura \ref{fig:modalErrorServiceClass}
\figura{Bitmap/Arquitectura/modalErrorServiceExample}{width=200px}{fig:errorModalExample}{Ejemplo de modal para un error del tipo 404}
\figura{Bitmap/Arquitectura/modalErrorServiceClass}{width=200px}{fig:modalErrorServiceClass}{Diagrama de clase del servicio de modales}

\subsection{Buscador de pictogramas}
Este componente tiene la utilidad principal de ser un punto de entrada para los pictogramas. En la vista podemos ver un input donde introducir el nombre del pictograma que se desea buscar. Una vez seleccionada la palabra o palabras que se desean buscar, el controlador del buscador, llamara al servicio de aplicaci�n el cual generara la URL usando el archivo de constantes de la aplicaci�n y llamara al servicio proxy, que se encargara de enviar y recibir la respuesta del servicio web. Una vez el servicio de aplicaci�n tiene la respuesta, se encarga de tratarla. En caso de error, sube la excepci�n hasta el controlador el cual llamara al servicio de modales, para informar al usuario del error. En caso de que la respuesta del servicio web sea correcta, el servicio de aplicaci�n del buscador se encargara de tratarla, y generar un objecto para el controlador, utilizando el transformer del componente. Una vez el controlador tiene el objeto final muestra un carousel de pictogramas, implementado gracias a la librer�a NGBoostrap. Este carousel nos permitir� a�adir im�genes al componente, traductor de pictogramas, gracias a una variable bindeada (pictoPhrase) entre los dos componentes. 
Podemos ver un diagrama de clase de todo el componente buscador en la Figura \ref{fig:finderClass}    
\figura{Bitmap/Arquitectura/finderClass}{width=300px}{fig:finderClass}{Diagrama de clase del componente buscador de pictogramas}

\subsection{Traductor de pictogramas} 

El traductor de pictogramas sigue la misma estructura interna que el buscador de pictogramas, eliminando el transformador tal y como podemos ver en la Figura \ref{fig:translatorComponent}. Este componente tiene el array de pictogramas que despu�s traduciremos, y sirve para lanzar la traducci�n.
El componente implementa un contenedor para los pictogramas, donde se muestran todos los pictogramas que forman la frase, este contenedor de pictogramas ha sido implementado utilizando la biblioteca Material de Angular\footnote{https://material.angular.io/}. Esta biblioteca nos permite entre otras cosas implementar este contenedor, que tiene drag and drop dentro de sus elementos, lo cual nos permite ordenar los pictogramas una vez a�adidos. Adem�s hemos a�adido un boton de borrar elementos, para eliminar aquellos pictogramas que se hayan a�adido por error, o simplemente para poder hacer diferentes traducciones.
\figura{Bitmap/Arquitectura/translatorComponent}{width=300px}{fig:translatorComponent}{Diagrama de clase del componente traductor}

Dada la simplicidad de la respuesta del servicio de generaci�n de lenguaje, este componente carece de un transformador para tratar la respuesta. El controlador de este componente recorre la lista de pictogramas del contenedor, y guarda en una lista el significado de cada uno de los pictogramas y le env�a al servicio de aplicaci�n del traductor esta lista.
El servicio de aplicaci�n genera el cuerpo de la petici�n POST y carga la URL del servicio de generaci�n de lenguaje del archivo de constantes, y llama al servicio proxy el cual sera encargado de lanzar la petici�n POST y devolverle la respuesta del servicio.
A diferencia del componente buscador de pictogramas, en caso de que la respuesta del servicio sea positiva se obtiene el cuerpo de la respuesta y se devuelve al controlador el cual sera el encargado de mostrar el resultado.

\subsection{Traductor de pictogramas por id}

Este componente es el m�s b�sico de los implementados, utiliza la misma arquitectura que el componente del traductor de pictogramas, tal y como podemos ver en la Figura \ref{fig:IdPictogramTranslator}.
Este componente tiene como finalidad obtener las diferentes traducciones de un pictograma, gracias al identificador de ese pictograma, el cual es recogido del input por el controlador, para seguir el flujo llamando a su servicio de aplicaci�n, el cual generara la URL con el identificador del pictograma y la URL del servicio web de traducci�n de pictogramas por id, y llama al proxy el cual se encargara de lanzar la petici�n GET y devolver la respuesta del servicio. Dado que la respuesta del servicio es muy sencilla hemos decidido omitir el transformador y en el mismo servicio de aplicaci�n obtener el string de significados y devolverlo al controlador el cual sera el encargado de mostrarlo por pantalla al usuario.


\figura{Bitmap/Arquitectura/IdPictogramTranslator}{width=300px}{fig:IdPictogramTranslator}{Diagrama de clase del componente traductor de pictogramas por id}
